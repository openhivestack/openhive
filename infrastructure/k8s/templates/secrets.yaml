apiVersion: v1
kind: Secret
metadata:
  name: {{ include "openhive.fullname" . }}-secrets
  labels:
    {{- include "openhive.labels" . | nindent 4 }}
type: Opaque
data:
  # Standard Secrets (Base64 encoded by Helm if passed as strings, but usually better to use existing secrets in prod)
  # For this chart, we'll allow passing values via values.yaml which is okay for private/demo,
  # but we recommend using external secrets for prod.
  BETTER_AUTH_SECRET: {{ .Values.secrets.betterAuthSecret | b64enc | quote }}
  GATEWAY_SECRET: {{ .Values.secrets.gatewaySecret | b64enc | quote }}
  GH_CLIENT_ID: {{ .Values.secrets.githubClientId | b64enc | quote }}
  GH_CLIENT_SECRET: {{ .Values.secrets.githubClientSecret | b64enc | quote }}

---
# Create a secret for the registry credentials if needed (for Kaniko or Image Pull)
# NOTE: The registry chart typically creates a secret, but we might need to alias it or create one
# if we are using an external registry or if the chart name differs.
# The registry chart creates 'openhive-registry-secret' by default? Let's ensure 'regcred' exists or alias it.
# Actually, Kaniko in our code expects 'regcred' (via env var default) but we pass 'openhive-registry-secret' in values?
# Wait, in lib/k8s-cloud.provider.ts:
# this.registrySecretName = process.env.K8S_REGISTRY_SECRET || "regcred";
# And in deployment.yaml we don't seem to set K8S_REGISTRY_SECRET explicitly?
# Let's just create 'regcred' here for simplicity if it's missing, OR better:
# Let's rely on the one created by the docker-registry chart, BUT we need to know its name.
# The docker-registry chart creates a secret named: {{ template "docker-registry.fullname" . }}-secret ?
# Or we can create our own manually to be safe.
# Since we are running a local registry without auth by default, we might not strictly need a secret
# BUT Kaniko might complain if we mount a non-existent one.
# Let's create a dummy 'regcred' if we don't have real creds, just to satisfy the volume mount.
apiVersion: v1
kind: Secret
metadata:
  name: regcred
  labels:
    {{- include "openhive.labels" . | nindent 4 }}
type: kubernetes.io/dockerconfigjson
data:
  .dockerconfigjson: e30K

